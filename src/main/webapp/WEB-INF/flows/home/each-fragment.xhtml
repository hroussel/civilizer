<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    >

<c:set var="fragment" value="#{fragmentBean.fragment}" />
               
<!-- <div class="each-fragment-container"> -->
    <h:panelGrid styleClass="each-fragment" columns="1" border="#{withOverlay ? 0 : 1}">
        <f:facet name="header">
            <div class="fragment-header" _fid="#{fragment.id}" _deletable="#{panelContext.fragmentDeletable}" title="#{msg['rclick_for_menu']}">
	            <c:choose>
		            <c:when test="#{withOverlay}">
		                <h:outputText value="##{fragment.id}" style="color:navy;"/>
		            </c:when>
		            <c:otherwise>
		                <p:selectBooleanCheckbox onchange="onChangeFragmentCheckbox('#{fragment.id}', '#{panelId}')" value="#{fragmentBean.checked}" itemLabel="&nbsp;" widgetVar="fragmentCheckboxSlave${panelId}_${loop.index}" />
		                <a class="-cvz-frgm" href="fragment/#{fragment.id}">\##{fragment.id}</a>
		            </c:otherwise>
	            </c:choose>
                <span class="fragment-title" _fid="#{fragment.id}">
                    <h:outputText escape="false" value="#{fragmentBean.title}" />
                </span>
                <h:outputText style="display:none" value="#{fragment.updateDatetime}">
                    <f:converter converterId="jodaDateTimeConverter" />
                </h:outputText>
                <span class="fa fa-clock-o"></span>&nbsp;&nbsp;
                <c:choose>
                    <c:when test="#{withOverlay}">
			            <c:forEach var="tag" items="#{fragment.tags}">
				             <span class="tag-box" title="">
				                 <span class="fa fa-tag " >&nbsp;</span>
				                 <h:outputText styleClass="each-tag-name" value="#{tag.tagName}"></h:outputText>
				             </span>
			            </c:forEach>                
                    </c:when>
                    <c:otherwise>
		                <c:forEach var="tag" items="#{fragment.tags}">
		                    <p:commandLink action="filter-by-tag" styleClass="tag-button" title="">
		                        <span class="fa fa-tag " ></span>
		                        <h:outputText styleClass="each-tag-name" value="#{tag.tagName}"></h:outputText>
		                        <f:param name="tagId" value="#{tag.id}" />
		                        <f:param name="panelId" value="#{panelId}" />
		                    </p:commandLink>
		                </c:forEach>
                    </c:otherwise>
                </c:choose>
                <h:outputText style="display:none" styleClass="-cvz-data-title" value="#{fragment.title}"/>
				<h:outputText style="display:none" styleClass="-cvz-data-tags" value="#{fragmentBean.concatenatedTagNames}"/>
				<h:outputText style="display:none" styleClass="-cvz-data-content" value="#{fragment.content}"/>
           	</div>
        </f:facet>
    	<h:outputText value="#{fragmentBean.content}" styleClass="fragment-content #{panelContext.getContextClassName()}"/>
    </h:panelGrid> <!--     each-fragment -->
<!-- </div> -->

<div class="related-fragment-container">
    <c:forEach var="rf" items="#{fragment.relatedOnes}">
        <span class="small-fragment-box">
            <span class="fa fa-link">&nbsp;&nbsp;</span>
            <a class="-cvz-frgm" href="fragment/#{rf.id}">\##{rf.id}</a>
            &nbsp;&nbsp;
            <h:outputText value="#{rf.title}" />
            &nbsp;&nbsp;
            <p:commandLink style="text-decoration:none; color:brown;" oncomplete="confirmUnrelatingFragments('#{fragment.id}', '#{rf.id}')" >
               <span class="fa fa-close button-link " title="#{msg['clear_relationship']}"></span>
            </p:commandLink>
        </span>
    </c:forEach>
</div>

</ui:composition>