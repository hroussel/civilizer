<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    >

<c:set var="fragment" value="#{fragmentBean.fragment}" />
               
<h:inputHidden id="fragment-title-placeholder-panel#{panelId}-#{fragment.id}" value="#{fragment.title}" />
<h:inputHidden id="fragment-content-placeholder-panel#{panelId}-#{fragment.id}" value="#{fragment.content}" />
<h:inputHidden id="fragment-tagnames-placeholder-panel#{panelId}-#{fragment.id}" value="#{fragmentBean.concatenatedTagNames}" />
   
<div class="each-fragment-container">
    <h:panelGrid styleClass="each-fragment" columns="1" border="1">
        <f:facet name="header">
            <div class="fragment-header" _fid="#{fragment.id}" _deletable="#{panelContext.fragmentDeletable}">
                <p:selectBooleanCheckbox value="#{fragmentBean.checked}" itemLabel="&nbsp;" widgetVar="fragmentCheckboxSlave${panelId}_${loop.index}" />
                <a class="-cvz-frgm" href="${request.contextPath}/app/fragment/#{fragment.id}">
                    \##{fragment.id}
                </a>&nbsp;&nbsp;
                <span class="fragment-title" _fid="#{fragment.id}">
                    <h:outputText escape="false" value="#{fragmentBean.title}" />
                </span>&nbsp;&nbsp;
                <c:forEach var="tag" items="#{fragment.tags}">
                    <p:commandLink action="filter-by-tag" styleClass="tag-button" title="#{tagBean.fragmentCount} #{msg['label_fragments']}">
                        <span class="fa fa-tag " ></span>
                        <h:outputText styleClass="each-tag-name" value="#{tag.tagName}"></h:outputText>
                        <f:param name="tagId" value="#{tag.id}" />
                    </p:commandLink>
                </c:forEach>&nbsp;&nbsp;
                <h:outputText style="font-weight:lighter;" value="#{fragment.updateDatetime}">
                    <f:converter converterId="jodaDateTimeConverter" />
                </h:outputText>
           	</div>
        </f:facet>
    	<h:outputText value="#{fragmentBean.content}" styleClass="fragment-content #{panelContext.getContextClassName()}"/>
    </h:panelGrid> <!--     each-fragment -->
</div> <!-- each-fragment-container -->

<div class="related-fragment-container">
    <c:forEach var="rf" items="#{fragment.relatedOnes}">
        <span class="small-fragment-box">
            <span class="fa fa-link">&nbsp;&nbsp;</span>
            <a class="-cvz-frgm" href="${request.contextPath}/app/fragment/#{rf.id}">\##{rf.id}</a>
            &nbsp;&nbsp;
            <h:outputText value="#{rf.title}" />
            &nbsp;&nbsp;
            <p:commandLink style="text-decoration:none; color:brown;" oncomplete="confirmUnrelatingFragments('#{fragment.id}', '#{rf.id}')" >
               <span class="fa fa-close button-link " title="#{msg['clear_relationship']}"></span>
            </p:commandLink>
        </span>
    </c:forEach>
</div>

</ui:composition>