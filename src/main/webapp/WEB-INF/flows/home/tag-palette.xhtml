<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui">
    
<script>
//<![CDATA[
$(document).ready(function() {
	$("#tag-palette-panel").on("mouseenter", ".each-tag", function() {
        $(this).find(".tag-menu").first().show();
    });
    
    $("#tag-palette-panel").on("mouseleave", ".each-tag", function() {
        $(this).find(".tag-menu").first().hide();
    });
    
    var currentTagGroupTabIndex = "0";

    $tab = $( "#tag-palette-panel" ).tabs({
         activate : function (e, ui) {
            currentTagGroupTabIndex = ui.newTab.index().toString();
            sessionStorage.setItem('tag-palette-tab-index', currentTagGroupTabIndex);
         }
    });

    if (sessionStorage.getItem('tag-palette-tab-index')) {
        currentTagGroupTabIndex = sessionStorage.getItem('tag-palette-tab-index');
        $tab.tabs('option', 'active', currentTagGroupTabIndex);
    }
    
    $(".each-tag").bind("contextmenu", function(event) {
    	var menu = $("#tag-context-menu");
    	menu.css({ left:event.pageX, top:event.pageY }).show();
    	menu.data("target-tag", $(event.target).closest(".each-tag"));
    	event.preventDefault();
    });

    $(document).bind("click", function(event) {
    	$("#tag-context-menu").hide();
    });
}); // end of $(document).ready()

function showEditTagDialog() {
    var dlg = PF('editTagDlg');
    dlg.show();
	var menu = $("#tag-context-menu");
	var target = menu.data("target-tag");
	var tagId = target.attr("_tid");
	var tagName = target.find(".each-tag-name").text();
    if (tagId > 0) {
        // [NOTE] user editable tags have id > 0
        $("#tag-palette-form\\:id-placeholder-for-tag").val(tagId);
    }
    $("#tag-palette-form\\:edit-tag-dlg-name-input").val(tagName);
}

//]]>
</script> 

<div>
    <span id="tag-palette-title" class="fa fa-tags" >&nbsp;&nbsp;#{msg['label_tag_palette']}</span>
</div>

<h:form id="tag-palette-form">
    <p:dialog header="#{msg['label_rename']}" width="300px" modal="true" showEffect="fade" widgetVar="editTagDlg" position="center" draggable="true" resizable="false" >
        <h:outputLabel for="edit-tag-dlg-name-input" value="#{msg['label_name']} :" />
        <p:inputText style="min-width:200px" id="edit-tag-dlg-name-input" value="#{paramTagBean.tag.tagName}" />
        <h:inputHidden id="id-placeholder-for-tag" value="#{paramTagBean.tag.id}" />
        <br /><br />
        <p:commandButton action="save-tag" value="#{msg['label_ok']}" icon="ui-icon-check">
        </p:commandButton>
    </p:dialog>
    
    <div id="tag-context-menu" style="display:none; z-index:5000; position:absolute;">
	    <p:menu>
            <p:menuitem styleClass="fa" onclick="showEditTagDialog()" value="&#xf040; #{msg['label_rename']}"/>
            <p:menuitem styleClass="fa" onclick="confirmTrashingTagFromCtxtMenu()" value="&#xf1f8; #{msg['label_trash']}"/>
	    </p:menu>
    </div>
    
    <div id="tag-palette-panel">
        <ul>
            <li>
                <a href="#tag-palette-linear" title="#{msg['label_linear_view']}" >
                    <span class="fa fa-list fa-2x" ></span>
                </a>
            </li>
            <li>
                <a href="#tag-palette-tree" title="#{msg['label_tree_view']}" >
                    <span class="fa fa-tree fa-2x" ></span>
                </a>
            </li>
        </ul>
        
        <h:panelGrid columns="2" styleClass="target-panel-selector" columnClasses="target-panel-selector-col-0, target-panel-selector-col-1" >
	        <label class="fa fa-file-text" for="panel-radio-for-tag-palette" >&nbsp;&nbsp;#{msg['label_panel']}</label>
	        <p:selectOneRadio id="panel-radio-for-tag-palette" value="#{customParams.panelIdForTagPalette}">
	            <f:selectItem itemLabel="0" itemValue="0" />
	            <f:selectItem itemLabel="1" itemValue="1" />
	            <f:selectItem itemLabel="2" itemValue="2" />
	        </p:selectOneRadio>
	    </h:panelGrid>
	    
	    <div id="trashcan">
		    <p:commandLink action="filter-by-tag" title="#{msg['go_to_trashcan']}">
		        <span class="fa fa-trash fa-2x button-link" style="color:lightgray"></span>
		        <f:param name="tagId" value="0" />
		    </p:commandLink>
		</div>
	    
        <div id="tag-palette-linear">
            <c:forEach var="tagBean" items="#{tagListBean.tagBeans}">
                <c:set var="tag" value="#{tagBean.tag}"/>
                <ui:include src="each-tag.xhtml" />
                <br />
            </c:forEach>
        </div>
        <div id="tag-palette-tree">
            <p:tree value="#{tagListBean.tagTree.root}" var="tagBean" dynamic="true" style="width:100%">
            	<p:ajax event="expand" listener="#{tagListBean.tagTree.onNodeExpand}" />
            	<p:ajax event="collapse" listener="#{tagListBean.tagTree.onNodeCollapse}" />
                <c:set var="tag" value="#{tagBean.tag}"/>
                <p:treeNode>
                    <ui:include src="each-tag.xhtml" />
                </p:treeNode>
            </p:tree>
        </div>
    </div>
</h:form>

</ui:composition>