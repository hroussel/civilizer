<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui">
    
<div class="sidebar-title">
    <span id="file-box-title" class="fa fa-file" >&nbsp;&nbsp;#{msg['label_filebox']}</span>
</div>

<h:form id="file-box-form" enctype="multipart/form-data">
	<p:dialog header="" width="300px" modal="true" closeOnEscape="true" closhowEffect="fade" widgetVar="renameFileDlg" position="center" draggable="true" resizable="false">
        <h:outputLabel for="rename-file-dlg-name-input" value="#{msg['label_name']} "/>
        <p:inputText style="min-width:200px" id="rename-file-dlg-name-input" value="#{fileListBean.fileName}"/>
        <br/><br/>
        <p:commandButton action="rename-file" value="#{msg['label_ok']}" icon="ui-icon-check"/>
    </p:dialog>

	<p:dialog width="300px" modal="true" closeOnEscape="true" showEffect="fade" widgetVar="moveFileDlg" position="center" draggable="true" resizable="false">
        <p:tree id="folder-tree" value="#{fileListBean.folderTree.root}" var="folderPathBean" style="width:100%">
            <p:treeNode dynamic="true">
                <span class="each-file fa #{folderPathBean.getCssClassName()}" _id="#{folderPathBean.id}" _fp="#{folderPathBean.fullPath}">
                	#{folderPathBean.getName()}
             	</span>
            </p:treeNode>
        </p:tree>
        <br/><h:outputText styleClass="fa" id="dst-path" value=""/><br/>
        <br/><span class="fa fa-arrow-circle-up fa-2x"></span><br/>
        <br/><h:outputText id="src-path" value=""/><br/>
        <div id="file-upload-box">
        	<!-- [TODO] externalize any other configurable parameters like this file size limit value -->
	        <p:fileUpload id="file-selector" value="#{fileUploadBean.file}" mode="simple" skinSimple="true" sizeLimit="#{cfg['file.upload.size.limit']}" style="width:200px"/>
			<br/>
        </div>
        <div style="display:none;">
	        <p:commandButton id="ok-move" action="move-file"/>
<!-- 	    [NOTE] for the file upload to work, ajax="false" is necessary -->
<!-- 	    <p:remoteCommand> does not work with file upload for the current version of Primefaces -->
	        <p:commandButton id="ok-upload" action="upload-file" ajax="false"/>
        </div>
	    <p:commandButton id="ok" value="#{msg['label_ok']}" icon="ui-icon-check"/>
    </p:dialog>
    
    <div id="file-context-menu" style="display:none; z-index:5000; position:absolute;">
	    <p:menu>
            <p:menuitem id="upload" styleClass="fa" oncomplete="showFileUploadDialog()" value="&#xf093;+ #{msg['label_upload_file']}"
            	update="folder-tree" actionListener="#{fileListBean.folderTree.populateNodes(null)}"/>
            <p:menuitem id="new-folder" styleClass="fa" onclick="showNewDirectoryDialog()" value="&#xf07c;+ #{msg['label_new_folder']}"/>
            <p:menuitem id="rename" styleClass="fa" onclick="showRenameFileDialog()" value="&#xf040; #{msg['label_rename']}"/>
            <p:menuitem id="move" styleClass="fa" oncomplete="showMoveFileDialog()" value="&#xf0c5; #{msg['label_move']}"
            	update="folder-tree" actionListener="#{fileListBean.folderTree.populateNodes(null)}"/>
            <p:menuitem id="delete" styleClass="fa" onclick="confirmDeletingFile()" value="&#xf1f8; #{msg['label_delete']}"/>
	    </p:menu>
    </div>
    
    <h:inputHidden id="id-placeholder-for-src-node" value="#{fileListBean.srcNodeId}"/>
    <h:inputHidden id="id-placeholder-for-dst-node" value="#{fileListBean.dstNodeId}"/>
    
	<p:panel id="file-box-panel" toggleable="true">
<!-- 		<f:facet name="header"> -->
<!-- 			<span id="file-box-title" class="fa fa-file" >&nbsp;&nbsp;#{msg['label_filebox']}</span> -->
<!-- 		</f:facet> -->
		<div id="file-path-tree">
            <p:tree value="#{fileListBean.filePathTree.root}" var="filePathBean" style="width:100%">
                <p:treeNode>
                    <span id="#{filePathBean.getHtmlId()}" class="each-file fa #{filePathBean.getCssClassName()}" _id="#{filePathBean.id}" _fp="#{filePathBean.fullPath}" _isFolder="#{filePathBean.isFolder()}">
                    	#{filePathBean.getName()}
	                </span>
                </p:treeNode>
            </p:tree>
        </div>
        <br/>
	</p:panel>
</h:form>

</ui:composition>