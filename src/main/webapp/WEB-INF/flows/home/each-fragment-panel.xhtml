<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    >
    
<p>&nbsp;</p>
<c:set var="fragmentListBean" value="#{fragmentListBeans[panelId]}"/>
<c:set var="panelContext" value="#{fragmentListBean.panelContextBean}" />
<c:set var="curTagId" value="#{panelContext.tagId}" />

<p:dialog header="#{msg['label_choose_sort_option']}" modal="true" width="230px" closeOnEscape="true" showEffect="fade" widgetVar="sortOptionDlg#{panelId}" position="center" draggable="false" resizable="false" >
    <div id="fragment-sort-option-container" >
        <p:selectOneListbox value="#{fragmentListBean.orderOption}">
            <f:selectItem itemLabel="#{msg['label_updated_time']}" itemValue="0" />
            <f:selectItem itemLabel="#{msg['label_created_time']}" itemValue="1" />
            <f:selectItem itemLabel="#{msg['label_title']}" itemValue="2" />
            <f:selectItem itemLabel="#{msg['label_id']}" itemValue="3" />
        </p:selectOneListbox>
    </div>
    <br /><br />
    <p:selectBooleanButton value="#{fragmentListBean.orderAsc}" styleClass="fa" onLabel="&#xf160;" offLabel="&#xf161;" />
    <br />
    <p:commandButton action="sort-fragments" value="#{msg['label_go_sort']}" icon="ui-icon-check">
        <f:param name="panelId" value="#{panelId}"/>
    </p:commandButton>
</p:dialog>

<p:panel id="fragment-panel-toolbar-#{panelId}" >
    <p:selectBooleanCheckbox id="checkbox-for-all-fragments-#{panelId}" rendered="#{fragmentListBean.hasFragments()}" itemLabel="" widgetVar="fragmentCheckboxMaster${panelId}" />
    
    <a href="#editor-frame" class="new-fragment-editor-trigger-on-toolbar" title="#{msg['label_new_fragment']}">
        <span class="fa fa-plus-square fa-2x new-resource-color button-link"></span>
    </a>
    
    <p:spacer width="6" />
    
    <p:commandLink oncomplete="showSearchDialog('#{panelId}')">
        <span class="fa fa-search fa-2x button-link" title="#{msg['label_search']}"></span>
    </p:commandLink>
    
    <p:spacer width="6" />
    
    <p:commandLink rendered="#{!panelContext.isFirstPage()}" action="prev-fragment-page">
        <f:param name="panelId" value="#{panelId}"/>
        <span class="fa fa-step-backward fa-2x button-link" title="#{msg['label_go_to_prev_page']}"></span>
    </p:commandLink>
    
    <p:spacer width="6" />
    
    <p:commandLink rendered="#{!panelContext.isLastPage()}" action="next-fragment-page">
        <f:param name="panelId" value="#{panelId}"/>
        <span class="fa fa-step-forward fa-2x button-link" title="#{msg['label_go_to_next_page']}"></span>
    </p:commandLink>
    
    <p:spacer width="6" />
    
    <p:commandLink action="go-home">
        <f:param name="panelId" value="#{panelId}"/>
        <span class="fa fa-home fa-2x button-link" title="#{msg['label_go_home']}"></span>
    </p:commandLink>
    
    <p:spacer width="6" />

    <p:commandLink oncomplete="showSortOptionDialog('#{panelId}')" >
        <span class="fa fa-sort fa-2x button-link" title="#{msg['label_sort']}"></span>
    </p:commandLink>
    
    <p:spacer width="6" />
    
    <c:choose>
        <c:when test="#{panelContext.fragmentDeletable}">
            <p:commandLink oncomplete="confirmTrashingFragments(null, true, true, '#{panelId}')" >
                <span class="fa fa-trash fa-2x button-link warning-color" style="display:none" title="#{msg['label_delete']}"></span>
            </p:commandLink>
        </c:when>
        <c:otherwise>
            <p:commandLink oncomplete="confirmTrashingFragments(null, false, true, '#{panelId}')" >
                <span class="fa fa-trash fa-2x button-link" style="display:none" title="#{msg['label_trash']}"></span>
            </p:commandLink>
        </c:otherwise>
    </c:choose>
</p:panel> <!-- id="fragment-panel-toolbar-#{panelId}" -->

<c:set var="tc" value="#{fragmentListBean.totalCount}" />
<c:set var="first" value="#{panelContext.firstItemOfCurPage()}" />
<c:set var="last" value="#{panelContext.lastItemOfCurPage(tc)} " />
<c:set var="curPage" value="#{panelContext.curPage+1} " />
<c:set var="totalPages" value="#{panelContext.totalPages(tc)} " />
<h:outputText styleClass="fa fa-file-text-o" style="font-weight:bold;color:darkgray;white-space:pre" 
    value=" #{msg['label_total']} : #{tc} [#{first} - #{last}]      #{msg['label_page']} : #{curPage} / #{totalPages}"/>
<c:if test="#{not empty panelContext.searchParams}">
    <div id="last-search-phrase-#{panelId}">
	    <span class="fa fa-search"></span>
	    <p:inputText value="#{panelContext.searchParams.searchPhrase}" onkeyup="searchWithHelpFromLastSearch(event, '#{panelId}', this)"/>
    </div>
</c:if>

<c:forEach var="fragmentBean" items="#{fragmentListBean.fragmentBeans}" varStatus="loop">
    <ui:include src="each-fragment.xhtml" />
</c:forEach>

<br/><br/><br/><br/>
    
</ui:composition>