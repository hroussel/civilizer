<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core" 
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/layouts/standard.xhtml">
                
<ui:define name="entry-point-scripts">
<script>
//<![CDATA[
$(document).ready(function() {
    $("#fragment-group").on("mouseenter", ".each-fragment-container", function() {
   		$(this).find(".fragment-menu").show();
   	});
    
    $("#fragment-group").on("mouseleave", ".each-fragment-container", function() {
   		$(this).find(".fragment-menu").hide();
   	});
    
    $(".fragment-content").each(function(){
    	var $this = $(this);
        var content = $this.text();
   	    $this.html(parseMarkdown(content));
   	});
    
    var fragmentCount = $("#fragment-group .each-fragment-container").length;
    if (fragmentCount > 0) {
	    var fragmentCheckboxMaster = PF("fragmentCheckboxMaster");
	    var fragmentCheckboxSlaves = [];    
	    
	    for (var i=0; i<fragmentCount; ++i) {
	        var cb = PrimeFaces.widgets["fragmentCheckboxSlave" + i];
	        fragmentCheckboxSlaves.push(cb);
	    }
	
	    var fragmentCheckboxMaster = PF("fragmentCheckboxMaster");
	    
	    // Align the master checkbox with its slaves in horizontal position
	    fragmentCheckboxMaster.jq.offset({ left:fragmentCheckboxSlaves[0].jq.offset().left });
	    
	    fragmentCheckboxMaster.jq.click(function (e) {
	        if (fragmentCheckboxMaster.isChecked()) {
		        for (var i=0; i<fragmentCount; ++i) {
		            fragmentCheckboxSlaves[i].check();
		        }
	        }
	        else {
		        for (var i=0; i<fragmentCount; ++i) {
	                fragmentCheckboxSlaves[i].uncheck();
	            }
	        }
	    });
    }
}); // end of $(document).ready()

function showSortOptionDialog(panelId) {
	var dlg = PF('sortOptionDlg' + panelId);
	dlg.show();
}
//]]>
</script>
</ui:define>

<ui:define name="content">

<h:form id="fragment-group-form">
<!--     <p:log id="log" /> -->
    <p:growl id="growl" showDetail="true" sticky="false" life="10000" />
    
    <div id="fragment-group">
        <c:set var="panelId" value="0" />
	    <div id="fragment-panel-#{panelId}">
	        <c:set var="fragmentListBean" value="#{fragmentListBeans[panelId]}"/>
	        <c:set var="panelContext" value="#{fragmentListBean.panelContextBean}" />
            <c:set var="curTagId" value="#{panelContext.tagId}" />
            <c:set var="curPage" value="#{panelContext.curPage}" />
            
            <p:dialog header="#{msg['label_choose_sort_option']}" modal="true" width="230px" showEffect="fade" widgetVar="sortOptionDlg#{panelId}" position="center" draggable="false" resizable="false" >
                <div id="fragment-sort-option-container" >
                    <p:selectOneListbox value="#{fragmentListBean.orderOption}">
                        <f:selectItem itemLabel="#{msg['label_by_updated_time']}" itemValue="0" />
                        <f:selectItem itemLabel="#{msg['label_by_created_time']}" itemValue="1" />
                        <f:selectItem itemLabel="#{msg['label_by_title']}" itemValue="2" />
                        <f:selectItem itemLabel="#{msg['label_by_id']}" itemValue="3" />
                    </p:selectOneListbox>
                </div>
                <br /><br />
                <p:inputSwitch value="#{fragmentListBean.orderAsc}" styleClass="fa" onLabel="&#xf160;" offLabel="&#xf161;" />
                <br />
	            <p:commandButton action="sort-fragments" value="#{msg['label_go_sort']}" icon="ui-icon-check">
	                <f:param name="curTagId" value="#{curTagId}"/>
                    <f:param name="curPage" value="#{curPage}"/>
	            </p:commandButton>
            </p:dialog>
	        
	        <p:panel id="fragment-panel-toolbar-#{panelId}" >
		        <p:selectBooleanCheckbox id="checkbox-for-all-fragments" rendered="#{fragmentListBean.hasFragments()}" itemLabel="&nbsp;" widgetVar="fragmentCheckboxMaster" />
		        <p:tooltip for="checkbox-for-all-fragments" value="#{msg['label_check_uncheck_all_fragments']}" />
		        
		        <a href="#editor-frame" class="new-fragment-editor-trigger-on-toolbar" title="#{msg['label_new_fragment']}">
			        <span class="fa fa-plus-square fa-2x new-resource-color button-link"></span>
		        </a>
		        
		        <p:spacer width="20" />
		        
		        <p:commandLink rendered="#{!panelContext.isFirstPage()}" action="prev-fragment-page">
		            <f:param name="curTagId" value="#{curTagId}"/>
		            <f:param name="curPage" value="#{curPage}"/>
			        <span class="fa fa-step-backward fa-2x button-link" title="#{msg['label_go_to_prev_page']}"></span>
		        </p:commandLink>
		        
		        <p:spacer width="20" />
		        
		        <p:commandLink rendered="#{!panelContext.isLastPage()}" action="next-fragment-page">
		            <f:param name="curTagId" value="#{curTagId}"/>
                    <f:param name="curPage" value="#{curPage}"/>
			        <span class="fa fa-step-forward fa-2x button-link" title="#{msg['label_go_to_next_page']}"></span>
		        </p:commandLink>
		        
		        <p:spacer width="20" />
		        
		        <p:commandLink action="go-home">
			        <span class="fa fa-home fa-2x button-link" title="#{msg['label_go_home']}"></span>
		        </p:commandLink>
		        
		        <p:spacer width="20" />

		        <p:commandLink oncomplete="showSortOptionDialog('#{panelId}')" >
			        <span class="fa fa-sort fa-2x button-link" title="#{msg['label_sort_fragments']}"></span>
		        </p:commandLink>
		        
		        <p:spacer width="20" />

		        <p:commandLink action="trash-fragments">
                    <span class="fa fa-trash fa-2x button-link" title="#{msg['label_trash_fragment']}"></span>
                </p:commandLink>
		        
	        </p:panel> <!-- id="fragment-panel-toolbar-#{panelId}" -->
		    
		    <c:forEach var="fragmentBean" items="#{fragmentListBean.fragmentBeans}" varStatus="loop">
		        <ui:include src="each-fragment.xhtml" />
		    </c:forEach>
	    </div>
    </div>
</h:form>

</ui:define> <!-- end of content -->

<ui:define name="sidebar">
    <ui:include src="sidebar.xhtml"></ui:include>
</ui:define>

<ui:define name="footer"><h5>This is Footer!!!</h5></ui:define>


</ui:composition>
