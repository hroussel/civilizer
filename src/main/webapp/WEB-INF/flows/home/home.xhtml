<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core" 
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/layouts/standard.xhtml">

<ui:define name="site-scripts">
	<ui:include src="js/document-ready-js.xhtml"/>
	<ui:include src="js/home-js.xhtml"/>
	<ui:include src="js/header-js.xhtml"/>
	<ui:include src="js/fragment-editor-js.xhtml"/>
	<ui:include src="js/bookmark-js.xhtml"/>
	<ui:include src="js/tag-palette-js.xhtml"/>
	<ui:include src="js/file-box-js.xhtml"/>
</ui:define>

<ui:define name="header">
    <ui:include src="header.xhtml"/>
</ui:define>

<ui:define name="content">

<div style='display:none' >
    <div id='fragment-overlay' >
        <div id="fragment-overlay-title-bar" >
        	<span id="fragment-overlay-title"></span>
            <div style="float: right;">
                <a id="fragment-overlay-close-button" href="#" title="#{msg['label_close']}">
                    <span class="fa fa-close fa-2x warning-color" ></span>
                </a>
            </div>
        </div>
        <div id="fragment-overlay-content"></div>
    </div>
</div>

<h:form id="fragment-group-form">
<!--     <p:log id="log"/> -->
<!--     <p:growl id="growl" showDetail="true" sticky="false" life="10000"/> -->
    <p:messages id="messages" globalOnly="true" showDetail="true" closable="true"/>
    <c:if test="#{systemProperties['civilizer.dev']}">
	    <!-- [DEV] -->
	    <p:messages id="development-messages" globalOnly="false" showDetail="true" closable="true"/>
    </c:if>
    
    <h:inputHidden id="id-placeholder-for-fragment" value="#{paramFragmentBean.fragment.id}"/>
    <h:inputHidden id="id-placeholder-for-trashed-tag" value="#{paramTagBean.tag.id}"/>
    <h:inputHidden id="id-placeholder-for-panel" value="#{customParams.panelId}"/>
    <h:inputHidden id="id-placeholder-for-search" value="#{searchContextBean.panelId}"/>
    <h:inputHidden id="id-placeholder-for-fragment0" value="#{customParams.fragmentId0}"/>
    <h:inputHidden id="id-placeholder-for-fragment1" value="#{customParams.fragmentId1}"/>
    <h:inputHidden id="id-placeholder-for-file" value="#{fileListBean.srcNodeId}"/>
    
    <p:confirmDialog header="#{msg['label_error']}" severity="alert" closeOnEscape="true" widgetVar="errorMsgDlg" showEffect="fade" hideEffect="explode">
        <f:facet name="message">
            <h:outputText id="error-msg" styleClass="warning-color" value="&nbsp;"/>
        </f:facet>
        <p:commandButton value="#{msg['label_ok']}" onclick="PF('errorMsgDlg').hide();" icon="ui-icon-check"/>
    </p:confirmDialog>
    
    <p:confirmDialog header="#{msg['are_you_sure']}" width="450px" severity="alert" closeOnEscape="true" widgetVar="confirmDlg" showEffect="fade" hideEffect="fade">
		<div style="display:none">
	        <p:commandButton id="ok-trash-fragment" action="trash-fragment"/>
	        <p:commandButton id="ok-delete-fragment" action="delete-fragment"/>
	        <p:commandButton id="ok-trash-fragments" action="trash-fragments"/>
	        <p:commandButton id="ok-delete-fragments" action="delete-fragments"/>
	        <p:commandButton id="ok-trash-tag" action="trash-tag"/>
	        <p:commandButton id="ok-delete-tag" action="delete-tag"/>
	        <p:commandButton id="ok-unbookmark-fragment" action="unbookmark-fragment"/>
	        <p:commandButton id="ok-unrelate-fragments" action="unrelate-fragments"/>
	        <p:commandButton id="ok-delete-files" action="delete-file"/>
		</div>
        <p:commandButton id="ok" value="#{msg['label_ok']}" icon="ui-icon-check"/>
    </p:confirmDialog>
    
    <p:dialog header="#{msg['label_search']}" width="500px" modal="true" closeOnEscape="true" showEffect="fade" widgetVar="searchDlg" position="center" draggable="true" resizable="false">
    	<p:accordionPanel id="search-panel">
	        <p:tab id="t0" title="#{msg['label_quick_search']}">
	            <p:inputText id="quick-search-input" style="width:80%" value="#{searchContextBean.quickSearchPhrase}"/>
	        </p:tab>
	        <p:tab id="t1" title="#{msg['label_normal_search']}">
	            <div>
		            <label class="fa fa-tag"> Tag </label>
		            <p:inputText id="tag-keywords" style="width:50%" value="#{searchContextBean.tagKeywords}"/>
		            <p:selectBooleanCheckbox value="#{searchContextBean.anyTag}" itemLabel="#{msg['label_any']}"/>
	            </div>
	            <div>
		            <label class="fa fa-header"> Title </label>
		            <p:inputText id="title-keywords" style="width:50%" value="#{searchContextBean.titleKeywords}"/>
		            <p:selectBooleanCheckbox value="#{searchContextBean.anyTitle}" itemLabel="#{msg['label_any']}"/>
	            </div>
	            <div>
		            <label class="fa fa-file-text-o"> Content </label>
		            <p:inputText id="content-keywords" style="width:50%" value="#{searchContextBean.contentKeywords}"/>
		            <p:selectBooleanCheckbox value="#{searchContextBean.anyContent}" itemLabel="#{msg['label_any']}"/>
	            </div>
	            <div>
		            <label class="fa fa-sort-numeric-asc"> ID </label>
		            <p:inputText id="id-keywords" style="width:50%" value="#{searchContextBean.idKeywords}"/>
	            </div>
	        </p:tab>
	    </p:accordionPanel>
	    <p:commandButton id="go-search" value="#{msg['label_search']}" icon="ui-icon-check"/>
    </p:dialog>
    
    <p:remoteCommand name="relateFragments" action="relate-fragments"/>
    <p:remoteCommand name="filterByTag" action="filter-by-tag" async="true"/>
    <p:remoteCommand name="bookmarkFragment" action="bookmark-fragment"/>
    <p:remoteCommand name="searchFragments" action="search-fragments" />
    
    <div id="frg-context-menu" style="display:none; z-index:5000; position:absolute;">
	    <p:menu>
            <p:menuitem id="edit" styleClass="fa" onclick="openFragmentEditorForEdit(event)" value="&#xf040; #{msg['label_edit']}"/>
            <p:menuitem id="bookmark" styleClass="fa" onclick="bookmarkFragmentFromCtxtMenu()" value="&#xf02e; #{msg['label_bookmark']}"/>
            <p:menuitem id="trash" styleClass="fa" onclick="trashFragmentFromCtxtMenu(false)" value="&#xf1f8; #{msg['label_trash']}"/>
            <p:menuitem id="delete" styleClass="fa" onclick="trashFragmentFromCtxtMenu(true)" value="&#xf1f8; #{msg['label_delete']}"/>
	    </p:menu>
    </div>
    
    <div id="fragment-group">
        <c:set var="panelId" value="0"/>
	    <div id="fragment-panel-#{panelId}" _pid="#{panelId}">
            <ui:include src="each-fragment-panel.xhtml"></ui:include>
	    </div>
	    
	    <c:set var="panelId" value="1"/>
        <div id="fragment-panel-#{panelId}" _pid="#{panelId}">
            <ui:include src="each-fragment-panel.xhtml"></ui:include>
        </div>
        
        <c:set var="panelId" value="2"/>
        <div id="fragment-panel-#{panelId}" _pid="#{panelId}">
            <ui:include src="each-fragment-panel.xhtml"></ui:include>
        </div>
    </div>
</h:form>

</ui:define> <!-- end of content -->

<ui:define name="sidebar">
    <ui:include src="sidebar.xhtml"></ui:include>
</ui:define>

<ui:define name="footer"></ui:define>

</ui:composition>
