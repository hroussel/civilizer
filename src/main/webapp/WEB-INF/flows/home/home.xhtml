<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:c="http://java.sun.com/jsp/jstl/core" 
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/layouts/standard.xhtml">
                
<ui:define name="script-test">
<script>
    $(document).ready(function() {
        $("#new-fragment-editor-trigger").colorbox({
            inline:true
            , overlayClose:false
            , onOpen:function() {
            	var el = $("#fragment-editor-form\\:title-input");
            	el.val(null);
            	el.watermark("Title");
            	
                el = $("#fragment-editor-form\\:tags-input");
            	el.val(null);
                el.watermark("Tags");
                
                $("#fragment-content-editor").val(null);
            }
        });
        
        $(".edit-fragment-editor-trigger").colorbox({
            inline:true
            , overlayClose:false
        });
        
        $("#colorbox").draggable({handle:'#cboxTitle', cursor:'move'});
        
        function parseMarkdown(inputText) {
            return markdown.toHTML(inputText);
        }

        extraMarkItUpSettings = {
            previewParser: parseMarkdown
        };
        
        $("#fragment-content-editor").markItUp(mySettings, extraMarkItUpSettings);
        
        $("#fragment-group").on("mouseenter", ".each-fragment-container", function() {
       		//console.log($(this).attr("fragmentId"));
       		$(this).find(".fragment-menu").show();
       	});
        
        $("#fragment-group").on("mouseleave", ".each-fragment-container", function() {
       		$(this).find(".fragment-menu").hide();
       	});
        
        $( "#tab-view-style" ).tabs();
    }); // end of $(document).ready()
    
    function openFragmentEditorForEdit(fragmentId, tagNames) {
        var el = $("#fragment-group-form\\:fragment-title-placeholder-"+fragmentId);
    	$("#fragment-editor-form\\:title-input").val(el.val());
    	$("#fragment-editor-form\\:tags-input").val(tagNames);
    	$("#fragment-editor-form\\:id-placeholder").val(fragmentId);
    	el = $("#fragment-group-form\\:fragment-content-placeholder-"+fragmentId);
        $("#fragment-content-editor").val(el.val());
    }
</script>
</ui:define>

<ui:define name="content">

<h:form id="fragment-group-form">
    <h:panelGrid columns="2" cellpadding="5">
		<h:outputText value="Simple" />
		<p:toolbar style="width:600px">
	        <p:toolbarGroup align="left">
	            <p:commandButton type="push" value="New" icon="ui-icon-document" />
	            <p:commandButton type="push" value="Open" icon="ui-icon-folder-open"/>
	
	            <p:separator />
	
	            <p:commandButton type="push" title="Save" icon="ui-icon-disk"/>
	            <p:commandButton type="push" title="Delete" icon="ui-icon-trash"/>
	            <p:commandButton type="push" title="Print" icon="ui-icon-print"/>
	        </p:toolbarGroup>
	
	        <p:toolbarGroup align="right">
	            <p:menuButton value="Navigate">
	                <p:menuitem value="Home" url="#" />
	                <p:menuitem value="Logout" url="#" />
	            </p:menuButton>
	        </p:toolbarGroup>
	    </p:toolbar>
    </h:panelGrid>
    
    <div id="fragment-group">    
	    <c:forEach var="fragmentBean" items="#{fragmentListBean.fragmentBeans}">
	        <div class="each-fragment-container" fragmentId="#{fragmentBean.fragment.id}">
		        <h:panelGrid styleClass="each-fragment" bgcolor="#eee" columns="1" border="1">
			        <f:facet name="header">
			        <div class="fragment-header">
			            <p:selectBooleanCheckbox value="#{fragmentBean.checked}" itemLabel="&nbsp;#{fragmentBean.fragment.id}" >
			            </p:selectBooleanCheckbox>
			            &nbsp;&nbsp;
<!-- 			            <p:commandLink value="#{fragmentBean.fragment.title} " actionListener="#{mainController.testActionListener}" action="show"> -->
<!-- 			                <f:attribute name="fragmentId" value="#{fragmentBean.fragment.id}"/> -->
<!-- 			                <f:param name="fragmentId" value="#{fragmentBean.fragment.id}"/> -->
<!-- 			            </p:commandLink> -->
			            <p:commandLink value="#{fragmentBean.fragment.title} " action="show">
			                <f:param name="fragmentId" value="#{fragmentBean.fragment.id}"/>
			            </p:commandLink>
			            &nbsp;&nbsp;
			            <h:outputText value="[ #{fragmentBean.tagNames} ]" />
			            &nbsp;&nbsp;
						<h:outputText style="font-weight:lighter;" value="#{fragmentBean.fragment.updateDatetime}">
							<f:converter converterId="jodaDateTimeConverter" />
						</h:outputText>
				        <span class="fragment-menu">
				        	<a href="#editor-frame" class='edit-fragment-editor-trigger' title="Edit Fragment" 
				        		onclick="openFragmentEditorForEdit('#{fragmentBean.fragment.id}', '#{fragmentBean.tagNames}')" >
					        	<img id="edit-fragment-button" src="resources/styles/custom/images/edit.png" />
					        </a>
					    <c:choose>
						    <c:when test="#{mainController.displayingTrash}">
						        <p:commandLink action="delete-fragment">
	                                <f:param name="fragmentId" value="#{fragmentBean.fragment.id}"/>
	                                <img id="delete-fragment-button" src="resources/styles/custom/images/trash.png" />
	                            </p:commandLink>
						    </c:when>
						    <c:otherwise>
						        <p:commandLink action="trash-fragment">
	                                <f:param name="fragmentId" value="#{fragmentBean.fragment.id}"/>
	                                <img id="delete-fragment-button" src="resources/styles/custom/images/trash.png" />
	                            </p:commandLink>
						    </c:otherwise>
					    </c:choose>
							<h:inputHidden id="fragment-title-placeholder-#{fragmentBean.fragment.id}" value="#{fragmentBean.fragment.title}" />
							<h:inputHidden id="fragment-content-placeholder-#{fragmentBean.fragment.id}" value="#{fragmentBean.fragment.content}" />
						</span>
			        </div>
					</f:facet>
			        <h:outputText value="#{fragmentBean.fragment.content}" />
		        </h:panelGrid>
	        </div>
	    </c:forEach>
    </div>
</h:form>

</ui:define> <!-- end of content -->

<ui:define name="sidebar">
    <ui:include src="sidebar.xhtml"></ui:include>
</ui:define>

<ui:define name="test-area">
</ui:define>

<ui:define name="footer"><h5>This is Footer!!!</h5></ui:define>


</ui:composition>
