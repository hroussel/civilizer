<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core" 
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/layouts/standard.xhtml">

<ui:define name="site-scripts">
	<ui:include src="js/constants.xhtml"/>
    <script src="resources/js/app/home/utils.js"></script>
    <script src="resources/js/app/home/home.js"></script>
    <script src="resources/js/app/home/header.js"></script>
    <script src="resources/js/app/home/fragment-editor.js"></script>
    <script src="resources/js/app/home/bookmark.js"></script>
    <script src="resources/js/app/home/tag-palette.js"></script>
    <script src="resources/js/app/home/selection-box.js"></script>
    <script src="resources/js/app/home/file-box.js"></script>
    <script src="resources/js/app/home/document-ready.js"></script>
</ui:define>

<ui:define name="header">
    <ui:include src="header.xhtml"/>
</ui:define>

<ui:define name="content">

<div style="display:none">
    <div id="fragment-overlay">
        <div id="fragment-overlay-title-bar" class="notxtslct ui-state-default" title="#{msg['dblclick_for_minmax']}">
        	<span id="fragment-overlay-title"></span>
            <div style="float:left">
                <a id="fragmen-overlay-back-button" href="#" title="#{msg['show_prev_fragment']}">
                    <span class="fa fa-step-backward" ></span>
                </a>
            </div>
            <div style="float:right">
                <a id="fragment-overlay-close-button" href="#" title="#{msg['label_close']}">
                    <span class="fa fa-close fa-2x warning-color" ></span>
                </a>
            </div>
        </div>
        <div id="fragment-overlay-content"></div>
    </div>
</div>

<h:form id="fragment-group-form">
<!--     <p:log id="log"/> -->
<!--     <p:growl id="growl" showDetail="true" sticky="false" life="10000"/> -->
    <p:messages id="messages" globalOnly="true" showDetail="true" closable="true"/>
    <c:if test="#{systemProperties['civilizer.dev']}">
	    <!-- [DEV] -->
	    <p:messages id="development-messages" globalOnly="false" showDetail="true" closable="true"/>
    </c:if>
    
<!--     <h:inputHidden id="id-placeholder-for-panel" value="#{customParams.panelId}"/> -->
    <h:inputHidden id="id-placeholder-for-file" value="#{fileListBean.srcNodeId}"/>
    
    <p:confirmDialog header="#{msg['label_error']}" severity="alert" closeOnEscape="true" widgetVar="errorMsgDlg" showEffect="fade" hideEffect="explode">
        <f:facet name="message">
            <h:outputText id="error-msg" styleClass="warning-color" value="&nbsp;"/>
        </f:facet>
        <p:commandButton value="#{msg['label_ok']}" onclick="PF('errorMsgDlg').hide();" icon="ui-icon-check"/>
    </p:confirmDialog>
    
    <p:confirmDialog header="#{msg['are_you_sure']}" width="450px" closeOnEscape="true" widgetVar="confirmDlg" showEffect="fade" hideEffect="fade">
		<div style="display:none">
	        <p:commandButton id="ok-trash-fragment" action="trash-fragment"/>
	        <p:commandButton id="ok-restore-fragment" action="restore-fragment"/>
	        <p:commandButton id="ok-delete-fragment" action="delete-fragment"/>
	        <p:commandButton id="ok-trash-fragments" action="trash-fragments"/>
	        <p:commandButton id="ok-unselect-all-fragments" action="unselect-all-fragments"/>
	        <p:commandButton id="ok-empty-trash" action="empty-trash"/>
	        <p:commandButton id="ok-trash-tag" action="trash-tag"/>
	        <p:commandButton id="ok-delete-tag" action="delete-tag"/>
	        <p:commandButton id="ok-unbookmark-fragment" action="unbookmark-fragment"/>
	        <p:commandButton id="ok-relate-fragment-pair" action="relate-fragment-pair"/>
	        <p:commandButton id="ok-relate-fragments" action="relate-fragments"/>
	        <p:commandButton id="ok-unrelate-fragments" action="unrelate-fragments"/>
	        <p:commandButton id="ok-delete-files" action="delete-file"/>
	        <p:commandButton id="ok-signout" action="signout-from-home"/>
		</div>
        <p:commandButton id="ok" value="#{msg['label_ok']}" icon="ui-icon-check"/>
    </p:confirmDialog>
    
    <p:dialog header="#{msg['label_search']}" width="500px" modal="true" closeOnEscape="true" showEffect="fade" widgetVar="searchDlg" position="center" draggable="true" resizable="false">
    	<p:accordionPanel id="search-panel">
	        <p:tab id="t0" title="#{msg['label_quick_search']}">
	            <p:inputText id="quick-search-input" style="width:80%" value="#{searchContextBean.quickSearchPhrase}"/>
	        </p:tab>
	        <p:tab id="t1" title="#{msg['label_normal_search']}">
	            <div>
		            <label class="fa fa-tag"> #{msg['label_tag']} </label>
		            <p:inputText id="tag-keywords" autocomplete="false" value="#{searchContextBean.tagKeywords}"/>
		            <p:selectBooleanCheckbox value="#{searchContextBean.anyTag}" itemLabel="#{msg['label_any']}"/>
	            </div>
	            <div>
		            <label class="fa fa-header"> #{msg['label_title']} </label>
		            <p:inputText id="title-keywords" value="#{searchContextBean.titleKeywords}"/>
		            <p:selectBooleanCheckbox value="#{searchContextBean.anyTitle}" itemLabel="#{msg['label_any']}"/>
	            </div>
	            <div>
		            <label class="fa fa-file-text-o"> #{msg['label_content']} </label>
		            <p:inputText id="content-keywords" value="#{searchContextBean.contentKeywords}"/>
		            <p:selectBooleanCheckbox value="#{searchContextBean.anyContent}" itemLabel="#{msg['label_any']}"/>
	            </div>
	            <div>
		            <label class="fa fa-sort-numeric-asc"> #{msg['label_id']} </label>
		            <p:inputText id="id-keywords" value="#{searchContextBean.idKeywords}"/>
	            </div>
	        </p:tab>
	    </p:accordionPanel>
	    <p:commandButton id="go-search" value="#{msg['label_search']}" icon="ui-icon-check"/>
    </p:dialog>
    
    <p:remoteCommand name="relateFragments" action="relate-fragment-pair"/>
    <p:remoteCommand name="filterByTag" action="filter-by-tag" async="true"/>
    <p:remoteCommand name="bookmarkFragment" action="bookmark-fragment"/>
    <p:remoteCommand name="searchFragments" action="search-fragments" />
    <p:remoteCommand name="touchFragment" action="touch-fragment" />
    
    <div id="frg-context-menu" style="display:none; z-index:5000; position:fixed;">
	    <p:menu>
            <p:menuitem id="edit" onclick="openFragmentEditorForEdit(event)" icon="fa fa-edit" value="#{msg['label_edit']}"/>
            <p:menuitem id="bookmark" onclick="bookmarkFragmentFromCtxtMenu()" icon="fa fa-bookmark" value="#{msg['label_bookmark']}"/>
            <p:menuitem id="trash" onclick="trashFragmentFromCtxtMenu(false)" icon="fa fa-trash" value="#{msg['label_trash']}"/>
            <p:menuitem id="delete" onclick="trashFragmentFromCtxtMenu(true)" icon="fa fa-trash" value="#{msg['label_delete']}"/>
            <p:menuitem id="restore" onclick="restoreFragmentFromCtxtMenu()" icon="fa fa-recycle" value="#{msg['label_restore']}"/>
            <p:menuitem id="relateNew" onclick="openFragmentEditorToRelate(event)" icon="fa fa-link" value="#{msg['label_relate_new']}"/>
            <p:menuitem id="touch" onclick="_touchFragment()" icon="fa fa-hand-o-up" value="#{msg['label_touch']}"/>
	    </p:menu>
    </div>
    
    <div id="fragment-group">
        <c:set var="panelId" value="0"/>
	    <div id="fragment-panel-#{panelId}" _pid="#{panelId}">
            <ui:include src="each-fragment-panel.xhtml"></ui:include>
	    </div>
	    
	    <c:set var="panelId" value="1"/>
        <div id="fragment-panel-#{panelId}" _pid="#{panelId}">
            <ui:include src="each-fragment-panel.xhtml"></ui:include>
        </div>
        
        <c:set var="panelId" value="2"/>
        <div id="fragment-panel-#{panelId}" _pid="#{panelId}">
            <ui:include src="each-fragment-panel.xhtml"></ui:include>
        </div>
    </div>
</h:form>

</ui:define> <!-- end of content -->

<ui:define name="sidebar">
    <ui:include src="sidebar.xhtml"></ui:include>
</ui:define>

<ui:define name="footer"></ui:define>

</ui:composition>
