<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" 
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    >
    
<script>
//<![CDATA[
$(document).ready(function() {
    $("#panel-activation-buttons").buttonset();

    var activeCount = 0;
    for (var i = 0; i < 3; i++) {
        if (sessionStorage.getItem('panel-' + i) === "on") {
            ++activeCount;
            $("#panel-toggler-" + i).prop("checked", true);
        }
    }
    if (activeCount === 0) {
        $("#panel-toggler-0").prop("checked", true);
    }
    
    var phTagPanelRadio = $("#fragment-group-form\\:id-placeholder-for-tag-palette-panel-radio");
    var idSpecifiedFromTagPalette = phTagPanelRadio.val();
    if (idSpecifiedFromTagPalette) {
        $("#panel-toggler-" + idSpecifiedFromTagPalette).prop("checked", true);
        phTagPanelRadio.val(null);
    }
    
    var phSearch = $("#fragment-group-form\\:id-placeholder-for-search");
    var idSpecifiedFromSearch = phSearch.val();
    if (idSpecifiedFromSearch) {
        $("#panel-toggler-" + idSpecifiedFromSearch).prop("checked", true);
        phSearch.val(null);
    }

    $("#panel-activation-buttons").buttonset("refresh");
    
    onPanelActivationChange();
}); // end of $(document).ready()

function onPanelActivationChange() {
    var panels = [ $("#fragment-panel-0"), $("#fragment-panel-1"), $("#fragment-panel-2") ];
    var activeCount = 0;
    
    for (var i=0; i<3; ++i) {
        if ($("#panel-toggler-" + i).prop("checked")) {
            ++activeCount;
            panels[i].show();
            $("fragment-group-form\\:fragment-panel-toolbar-"+i).offset({
                left: panels[i].offset().left
            });
            sessionStorage.setItem('panel-' + i, 'on');
        }
        else {
            panels[i].hide();
            sessionStorage.setItem('panel-' + i, 'off');
        }
    }
    
    var w = '100%';
    switch (activeCount) {
    case 2:
        w = '45%';
        break;
    case 3: 
        w = '30%';
        break;
    }
    for (var i=0; i<3; ++i) {
        panels[i].css({ width: w });
    }
}

function kickSearch(event, remoteCommand, panelId) {
	if (event.keyCode == 13) {
		remoteCommand([{name:'panelId',value:panelId}]);
	}
}
//]]>
</script>

<a href="#editor-frame" id="new-fragment-editor-trigger" class="button-link new-resource-color" title="#{msg['label_new_fragment']}" >
    <span class="fa fa-plus-square fa-2x"></span>
</a>

<h:form style="display:inline; margin:0; padding:0;">
    <span id="panel-activation-buttons" >
        <input type="checkbox" id="panel-toggler-0" style="display:none;" onchange="onPanelActivationChange();"/>
        <label for="panel-toggler-0" title="#{msg['toggle_panel']} 0">
            <span class="fa fa-file-text">&nbsp;#{msg['label_panel']} 0</span>
        </label>
        <input type="checkbox" id="panel-toggler-1" style="display:none;" onchange="onPanelActivationChange();"/>
        <label for="panel-toggler-1" title="#{msg['toggle_panel']} 1">
            <span class="fa fa-file-text">&nbsp;#{msg['label_panel']} 1</span>
        </label>
        <input type="checkbox" id="panel-toggler-2" style="display:none;" onchange="onPanelActivationChange();"/>
        <label for="panel-toggler-2" title="#{msg['toggle_panel']} 2">
            <span class="fa fa-file-text">&nbsp;#{msg['label_panel']} 2</span>
        </label>
    </span>
</h:form>

<h:form prependId="false" style="display:inline; margin:0; padding:0;">
    <span id="quick-search-area" >
        <c:set var="scb" value="#{searchContextBeans[0]}" />
        <span id="quick-search-0" class="fa fa-search fa-1x ui-panel ui-widget ui-widget-content ui-corner-all" />
        <span id="quick-search-box-0" >
            <p:remoteCommand name="quickSearch0" action="quick-search-fragments" />
            <h:inputText value="#{scb.quickSearchText}" onkeyup="kickSearch(event, quickSearch0, 0); return false;"/>
        </span>
        
        <p:spacer width="5" />
        
        <c:set var="scb" value="#{searchContextBeans[1]}" />
        <span id="quick-search-1" class="fa fa-search fa-1x ui-panel ui-widget ui-widget-content ui-corner-all" />
        <span id="quick-search-box-1" >
            <p:remoteCommand name="quickSearch1" action="quick-search-fragments" />
            <h:inputText value="#{scb.quickSearchText}" onkeyup="kickSearch(event, quickSearch1, 1); return false;"/>
        </span>
        
        <p:spacer width="5" />
        
        <c:set var="scb" value="#{searchContextBeans[2]}" />
        <span id="quick-search-2" class="fa fa-search fa-1x ui-panel ui-widget ui-widget-content ui-corner-all" />
        <span id="quick-search-box-2" >
            <p:remoteCommand name="quickSearch2" action="quick-search-fragments" />
            <h:inputText value="#{scb.quickSearchText}" onkeyup="kickSearch(event, quickSearch0, 2); return false;"/>
        </span>
    </span>
</h:form>

<div id="user-menu-area">
<h:form id="user-menu-form">
    <p:commandButton id="user-menu-trigger" value="&#xf007;" type="button" styleClass="fa" icon="ui-icon-extlink"/>
    <p:menu id="user-menu" overlay="true" trigger="user-menu-trigger" my="right top" at="right bottom">
        <p:menuitem value="#{msg['view_profile']}" ajax="false" />
        <p:menuitem value="#{msg['change_name']}" ajax="false" />
        <p:menuitem value="#{msg['change_password']}" ajax="false" />
        <p:menuitem value="#{msg['change_language']}" ajax="false" />
        <p:separator />
        <p:menuitem value="#{msg['sign_out']}" ajax="false" url="/app/signout"/>
    </p:menu>
</h:form>
</div>

<ui:include src="/WEB-INF/flows/home/fragment-editor.xhtml" />

</ui:composition>