<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html" 
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    >
    
<a href="#editor-frame" id="new-fragment-editor-trigger" class="button-link" title="#{msg['label_new_fragment']}" >
    <span class="fa fa-plus-square fa-1x"></span>
</a>

<h:form id="panel-button-form" style="display:inline; margin:0; padding:0;">
    <span id="panel-activation-buttons" >
        <input type="checkbox" id="panel-toggler-0" style="display:none;" onchange="onPanelActivationChange(true);"/>
        <label for="panel-toggler-0" _pid="0" title="#{msg['toggle_panel']}">
            <span class="fa fa-desktop"></span>
            <span> 0</span>
        </label>
        <input type="checkbox" id="panel-toggler-1" style="display:none;" onchange="onPanelActivationChange(true);"/>
        <label for="panel-toggler-1" _pid="1" title="#{msg['toggle_panel']}">
            <span class="fa fa-desktop"></span>
            <span> 1</span>
        </label>
        <input type="checkbox" id="panel-toggler-2" style="display:none;" onchange="onPanelActivationChange(true);"/>
        <label for="panel-toggler-2" _pid="2" title="#{msg['toggle_panel']}">
            <span class="fa fa-desktop"></span>
            <span> 2</span>
        </label>
    </span>
    
<!--     <div style="display:none"> -->
<!--         <p:commandButton id="id-cleaner" ajax="true" actionListener="#{customParams.clearPanelId()}"/> -->
<!--     </div> -->
</h:form>

<h:form prependId="false" style="display:inline; margin:0; padding:0;">
    <span id="search-buttons-at-header" >
        <p:commandLink oncomplete="showSearchDialog(0, null)" styleClass="button-link" title="#{msg['label_search']}">
        	<span class="fa fa-search fa-1x ui-panel ui-widget-content ui-corner-all" />
        </p:commandLink>
        <p:spacer width="5" />
        
        <p:commandLink oncomplete="showSearchDialog(1, null)" styleClass="button-link" title="#{msg['label_search']}">
        	<span class="fa fa-search fa-1x ui-panel ui-widget-content ui-corner-all" />
        </p:commandLink>
        
        <p:spacer width="5" />
        
        <p:commandLink oncomplete="showSearchDialog(2, null)" styleClass="button-link" title="#{msg['label_search']}">
        	<span class="fa fa-search fa-1x ui-panel ui-widget-content ui-corner-all" />
        </p:commandLink>
    </span>
</h:form>

<h:form id="user-menu-form">
    <span id="theme-icon" class="fa fa-paint-brush fa-2x"></span>
    
    <p:themeSwitcher widgetVar="themeSwitcher" id="theme-switcher" onchange="onChangeTheme()">
        <f:selectItems value="#{userProfileBean.themes}" var="theme" itemLabel="#{theme}" itemValue="#{theme}"/>
    </p:themeSwitcher>
    
    <div id="user-menu-area">
        <p:commandButton id="user-menu-trigger" icon="fa fa-user" type="button"/>
        <p:menu id="user-menu" overlay="true" triggerEvent="mouseenter" trigger="user-menu-trigger" my="right top" at="right bottom">
            <p:menuitem value="#{msg['about_app']}" onclick="showAboutDialog()" icon="fa fa-university"/>
            <p:menuitem value="#{msg['import_data']}" process="data-broker-export-mode" onclick="DBC.setMode(false)" oncomplete="DBC.showDialog()" icon="fa fa-upload"/>
            <p:menuitem value="#{msg['export_data']}" process="data-broker-export-mode" onclick="DBC.setMode(true)" oncomplete="DBC.showDialog()" icon="fa fa-download"/>
            <p:menuitem value="#{msg['change_profile']}" onclick="showProfileDialog()" icon="fa fa-edit"/>
            <p:separator />
            <p:menuitem value="#{msg['sign_out']}" onclick="confirmSignout()" icon="fa fa-sign-out"/>
        </p:menu>
        
        <p:dialog id="about-dlg" widgetVar="aboutDlg" header="#{msg['about_app']}" width="320px" closeOnEscape="true" modal="true" showEffect="fade" position="center" draggable="true" resizable="false">
            <span class="fa fa-university fa-2x ui-panel">#{msg['application_name']}</span>
            <p:panel>
                <p>#{msg['label_version']} #{core['civilizer.version']}</p>
                <p>Created by Suewon Bahng</p>
                <span class="fa fa-bug warning-color"></span><span> #{msg['report_bug']} </span>
                <p style="color:blue">suewonjp@gmail.com</p>
                <hr/>
                <p>Copyright &copy; 2014-2015 Suewon Bahng</p>
                <p>The Apache License, Version 2.0</p>
            </p:panel>
        </p:dialog>
        
        <p:dialog styleClass="rclick-disabled" id="data-broker-dlg" widgetVar="dataBrokerDlg" header="#{msg['export_data']}"
            width="460px" modal="true" showEffect="fade" position="center"
            onHide="DBC.onHide()" draggable="true" resizable="false">
            <h:inputHidden id="data-broker-export-mode" value="#{dataBrokerBean.exportMode}"/>

            <p:wizard widgetVar="dataBrokerWizard" flowListener="#{dataBrokerBean.onDataExportFlow}" showStepStatus="false" showNavBar="false">
                <p:tab id="auth-step">
                    <p:panel header="#{msg['type_password']}">
                        <h:panelGrid columns="2" cellpadding="5">
                            <span class="fa fa-key fa-2x"></span>
                            <p:password id="dbw-pw" onkeyup="DBC.onTypePw(this, event)"
                                style="width:300px" value="#{dataBrokerBean.password}" required="false"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="upload-step">
                    <p:panel header="#{msg['label_upload_file']}">
                        <h:panelGrid columns="1" cellpadding="5">
                            <p:fileUpload fileUploadListener="#{dataBrokerBean.onFileUpload}"
                                mode="advanced" auto="true"
                                oncomplete="DBC.onFileUpload()"/>
                            <h:outputText styleClass="fa fa-warning warning-color" value="#{msg['warn_data_import']}"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="import-error-step">
                    <p:panel>
                        <f:facet name="header">
                            <h:outputText styleClass="fa fa-warning warning-color" value="#{msg['label_error']}"/>
                        </f:facet>
                        <h:panelGrid columns="1" cellpadding="5">
                            <p:commandButton value="#{msg['label_close']}" onclick="DBC.hideDialog()" icon="fa fa-close"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="confirm-import-step">
                    <p:panel>
                        <f:facet name="header">
                            <h:outputText styleClass="fa fa-thumbs-o-up" value="&nbsp;#{msg['label_success']}"/>
                        </f:facet>
                        <h:panelGrid columns="1" cellpadding="5">
                            <p:commandButton value="#{msg['refresh_page']}" oncomplete="location.replace('home')" onclick="DBC.hideDialog()" icon="fa fa-check"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="preexport-step">
                    <p:panel header="#{msg['label_wait']}">
                        <h:panelGrid columns="1" cellpadding="5">
                            <span style="margin-left:40%" class="fa fa-spinner fa-spin fa-2x"></span>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="export-step">
                    <p:panel header="#{msg['label_download_file']}">
                        <h:panelGrid columns="1" cellpadding="5">
                            <a href="exp/cvz-export.zip" onclick="DBC.onDownloadExportData()">
                                <span class="fa fa-download fa-2x"></span>
                            </a>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="confirm-export-step">
                    <p:panel>
                        <f:facet name="header">
                            <h:outputText styleClass="fa fa-thumbs-o-up" value="&nbsp;#{msg['label_success']}"/>
                        </f:facet>
                        <h:panelGrid columns="1" cellpadding="5">
                            <p:commandButton value="#{msg['label_ok']}" onclick="DBC.hideDialog()" icon="fa fa-check"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
            </p:wizard>

            <p:commandButton styleClass="ui-wizard-nav-next" onclick="DBC.onClickNext()" actionListener="#{dataBrokerBean.checkNext()}" process="@this"
                oncomplete="DBC.onCompleteNext(xhr, status, args)" icon="fa fa-hand-o-right fa-2x"/>
        </p:dialog>
        
        <p:dialog id="user-profile-dlg" widgetVar="userProfileDlg" header="#{msg['change_profile']}" width="620px" modal="true" showEffect="fade" position="center" draggable="true" resizable="false">
            <p:panel>
                <div class="fa fa-user">&nbsp;&nbsp;
                    <p:inplace widgetVar="userName">
                        <p:inputText style="width:80%" value="#{userProfileBean.userName}"/>
                    </p:inplace>
                    <h:outputText style="display:none" value="#{userProfileBean.userName}"/>
                </div>
            </p:panel>
            
            <p:panel>
                <label for="enable_password_change">#{msg['change_password']}</label>
                <input type="checkbox" name="enable_password_change" onchange="togglePasswordChange(this)"/>
            </p:panel>
    
            <div id="new-password-box">
                <h:panelGrid columns="2" cellpadding="5">
                    <p:outputLabel for="pwd1" value="#{msg['label_password']}"/>
                    <p:password id="pwd1" value="#{userProfileBean.password}" feedback="false" match="pwd2" required="true"/>
                    <p:outputLabel for="pwd2" value="#{msg['label_confirm_password']}"/>
                    <p:password id="pwd2" feedback="false" required="true"/>
                </h:panelGrid>
                <p:messages id="msg" showSummary="false" showDetail="true" autoUpdate="true" />
            </div>
            
            <p:commandButton widgetVar="userProfileDlgSave" disabled="true" action="update-user-profile" value="#{msg['label_save']}" icon="ui-icon-check"/>
        </p:dialog>
    </div>
</h:form>

<ui:include src="/WEB-INF/flows/home/fragment-editor.xhtml" />

</ui:composition>